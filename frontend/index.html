<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Prompt Converter</title>
  <style>
    body { font-family: Arial; margin: 24px; max-width: 1000px; }
    textarea { width: 100%; height: 140px; }
    pre { background: #111; color: #eee; padding: 16px; border-radius: 8px; overflow:auto; }
    .row { display:flex; gap:16px; }
    .col { flex:1; }
    button { padding: 10px 14px; cursor: pointer; }
    .badge { display:inline-block; padding: 4px 10px; border-radius: 999px; margin-left: 8px; }
    .ok { background: #d1fae5; color:#065f46; }
    .fail { background:#fee2e2; color:#991b1b; }
  </style>
</head>
<body>
  <h1>Text → JSON Prompt</h1>
  <p>Nhập prompt text. App sẽ convert và validate theo schema.</p>

  <textarea id="input" placeholder="VD: Close-up matcha latte, morning light, 85mm, f/2.0, 4:5, --no text, watermark"></textarea>
  <br/><br/>
  <button onclick="convert()">Convert</button>
  <span id="status"></span>

  <div class="row" style="margin-top:16px;">
    <div class="col">
      <h3>JSON Output</h3>
      <pre id="out">{}</pre>
    </div>
    <div class="col">
      <h3>Errors</h3>
      <pre id="errs">[]</pre>
    </div>
  </div>

<script>
async function convert(){
  const text = document.getElementById("input").value.trim();
  if(!text) return;

  const res = await fetch("http://localhost:8000/convert", {
    method:"POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({ text, lang:"vi", task:"image_generation" })
  });
  const data = await res.json();

  document.getElementById("out").textContent = JSON.stringify(data.prompt_json, null, 2);
  document.getElementById("errs").textContent = JSON.stringify(data.errors || [], null, 2);

  const status = document.getElementById("status");
  status.innerHTML = data.valid
    ? `<span class="badge ok">VALID</span>`
    : `<span class="badge fail">INVALID</span>`;
}
</script>
</body>
</html>
